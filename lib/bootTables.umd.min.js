!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bootTables={})}(this,function(t){"use strict";function e(...t){return t.some(t=>isNaN(t)||!t&&0!==t)}function a(t){return t?.columns?t.columns.filter(t=>"string"==typeof t.searchable?JSON.parse(t.searchable):t.searchable).map(t=>t.data):[]}function n(t){if(!Array.isArray(t?.order)||!t.order.length)return;const a=Number(t.order[0].column),n=t.order[0].dir;if(e(a)||!Array.isArray(t.columns)||a>=t.columns.length)return;if(!1===("string"==typeof t.columns[a].orderable?JSON.parse(t.columns[a].orderable):t.columns[a].orderable))return;const s=t.columns[a].data;return s?{key:s,dir:n}:void 0}function s(t){return Array.isArray(t?.columns)?t.columns.map(t=>String(t.data)):[]}function r(t,e){const{draw:a,start:n,length:s,searchable:r,search:i,sort:c,select:l}=e;try{const e=t.filter(t=>!r.length||!i||r.some(e=>String(t[e]).includes(i))),o=e.sort((t,e)=>{const{key:a,dir:n}=c||{};return!a||!n||"asc"!==n&&"desc"!==n?0:"asc"===n?"string"==typeof t[a]?t[a].localeCompare(e[a]):t[a]-e[a]:"string"==typeof e[a]?e[a].localeCompare(t[a]):e[a]-t[a]}).map(t=>l.reduce((e,a)=>(e[a]=t[a],e),{})).slice(n,n+s);return{draw:a,recordsTotal:t.length,recordsFiltered:e.length,data:o}}catch(e){return{draw:a,recordsTotal:t.length,recordsFiltered:t.length,data:void 0,error:e.message}}}async function i(t,e){try{const{$:a,tableId:n,visiblePages:s,renderCard:r}=t,i=Number(t.draw),c=e?.start||0,l=e?.length||6,o=t.columns.map(t=>t.data),d=e?.search||"",u=e?.sort||{key:o[0],dir:"asc"},p={draw:i,start:c,length:l,searchable:o,search:d,sort:u,select:[...o]};t.draw++;const{recordsTotal:h,recordsFiltered:m,data:g}=await t.getResponse(p);a(`#t_${n}_entries_list`).val(l),a(`#t_${n}_sort`).val(u.key);const b=t.cardSize?t.cardSize:1===l?12:2===l?6:4;a(`#t_${n}_cards`).empty(),g.forEach(e=>{const s=r?r(e,g):`\n                <div class="col-md-${b}">\n                    <div class="card">\n                        <div class="card-body">\n                            ${t.columns.map(({data:t,text:a},n)=>0===n?`<h5 class="card-title">${a||t}: ${e[t]}</h5>`:`<p class="card-text">${a||t}: ${e[t]}</p>`).join("")}\n                        </div>\n                    </div>\n                </div>\n            `;a(`#t_${n}_cards`).append(s)}),a(`#t_${n}_cards`).data("start",c),a(`#t_${n}_cards`).data("end",m||0);const f=Math.floor(c/l)+1,_=Math.max(1,Math.ceil((m??0)/l)),y=Math.max(1,f-Math.floor(s/2)),$=Math.min(_,y+s-1),v=Math.max(1,$-s+1);a(`#t_${n}_pagination`).empty(),a(`#t_${n}_pagination`).append(`\n        <li class="page-item ${1===f?"disabled":""}">\n            <button class="page-link" id="prev-btn">Previous</button>\n        </li>\n        `);for(let t=v;t<=$;++t)a(`#t_${n}_pagination`).append(`\n            <li class="page-item ${t===f?"active":""}">\n                <button class="page-link">${t}</button>\n            </li>\n            `);a(`#t_${n}_pagination`).append(`\n        <li class="page-item ${f===_?"disabled":""}">\n            <button class="page-link" id="next-btn">Next</button>\n        </li>\n        `);const x=Math.min(f*l,m??0);a(`#t_${n}_entries`).text(`Showing ${c+1} to ${x} of ${m} entries`+(h!==m?` (filtered from ${h} total entries)`:""))}catch{}}function c(t){const{$:e,tableId:a,selectEntries:n,columns:s}=t;e(`#${a}`).empty(),e(`#${a}`).append(`\n        \x3c!-- Controls above the cards --\x3e\n        <div class="row gy-2 mb-4 align-items-center">\n    \n            \x3c!-- Entries Dropdown --\x3e\n            <div class="col-12 col-md-4 d-flex align-items-center justify-content-center justify-content-md-start">\n                <label class="me-2">Show</label>\n                <select id="t_${a}_entries_list" class="form-select w-auto me-2">\n                    ${n.map((t,e)=>`<option value="${t}" ${0===e?"selected":""}>${t}</option>`).join("")}\n                </select>\n                <span>entries</span>\n            </div>\n\n            \x3c!-- Sort Dropdown --\x3e\n            <div class="col-12 col-md-8 d-flex align-items-center justify-content-center justify-content-md-end gap-2">\n                <label>Sort by</label>\n                <select id="t_${a}_sort" class="form-select w-auto">\n                    ${s.map(({data:t,text:e},a)=>`<option value="${t}" ${0===a?"selected":""}>${e||t}</option>`).join("")}\n                </select>\n                \x3c!-- Search Bar --\x3e\n                <input id="t_${a}_search" type="text" class="form-control" style="max-width: 150px" placeholder="Search by">\n            </div>\n\n        </div>\n\n        \x3c!-- Data cards row --\x3e\n        <div id="t_${a}_cards" class="row gy-4 mb-4" data-start="0", data-end="0">\n        </div>\n\n        \x3c!-- Bottom controls --\x3e\n        <div class="row gy-2 mb-4 align-items-center">\n            \x3c!-- Showing info, center on xs, left on md+ --\x3e\n            <div id="t_${a}_entries" class="col-12 col-md-6 d-flex align-items-center justify-content-center justify-content-md-start">\n                Showing 0 to 0 of 0 entries\n            </div>\n            \n            \x3c!-- Pagination, center on xs, right on md+ --\x3e\n            <div class="col-12 col-md-6 d-flex align-items-center justify-content-center justify-content-md-end">\n                <nav aria-label="Page navigation">\n                    <ul id="t_${a}_pagination" class="pagination mb-0">\n                        <li class="page-item disabled">\n                            <a class="page-link" href="#">Previous</a>\n                        </li>\n                        <li class="page-item active">\n                            <a class="page-link" href="#">1</a>\n                        </li>\n                        <li class="page-item ">\n                            <a class="page-link" href="#">Next</a>\n                        </li>\n                    </ul>\n                </nav>\n            </div>\n        </div>\n    `),i(t),e(`#t_${a}_entries_list`).on("change",async function(n){n.preventDefault(),await i(t,{start:0,length:parseInt(e(this).val()),search:e(`#t_${a}_search`).val(),sort:{key:e(`#t_${a}_sort`).val(),dir:"asc"}})}),e(`#t_${a}_sort`).on("change",async function(n){n.preventDefault(),await i(t,{start:0,length:parseInt(e(`#t_${a}_entries_list`).val()),search:e(`#t_${a}_search`).val(),sort:{key:e(this).val(),dir:"asc"}})}),e(`#t_${a}_search`).on("input",async function(n){n.preventDefault(),await i(t,{start:0,length:parseInt(e(`#t_${a}_entries_list`).val()),search:e(this).val(),sort:{key:e(`#t_${a}_sort`).val(),dir:"asc"}})}),e(`#t_${a}_pagination`).on("click",".page-link",async function(n){n.preventDefault();const s=e(this).text(),r=parseInt(e(`#t_${a}_cards`).data("start")),c=parseInt(e(`#t_${a}_cards`).data("end")),l=parseInt(e(`#t_${a}_entries_list`).val()),o="Previous"===s?Math.max(0,r-l):"Next"===s?Math.min(r+l,c):(parseInt(s)-1)*l;await i(t,{start:o,length:l,search:e(`#t_${a}_search`).val(),sort:{key:e(`#t_${a}_sort`).val(),dir:"asc"}})})}t.Table=class{$;draw;ajax;columns;tableId;selectEntries;cardSize;visiblePages;data;renderCard;constructor(t){const{ajax:e,columns:a,tableId:n,selectEntries:s,cardSize:r,data:i,renderCard:l}=t,o=globalThis?.$;if(!o)throw new Error("Does not have jQuery");this.$=o,this.draw=0,this.ajax=e,this.columns=a,this.tableId=n,this.selectEntries=s??[3,6,12],this.cardSize=r,this.visiblePages=5,this.data=i,this.renderCard=l,c(this)}async drawTable(t){return i(this,t)}getResponse(t){return this.data?r(this.data,t):this.ajax?this.ajax(t):{draw:t.draw,recordsTotal:0,recordsFiltered:0,data:[]}}},t.buildParams=function(t){return{draw:Number(t?.draw),start:Number(t?.start),length:Number(t?.length),searchable:a(t),search:t?.search?.value,sort:n(t),select:s(t)}},t.buildSearchableFields=a,t.buildSelectParams=s,t.buildSortParam=n,t.drawTable=i,t.initTable=c,t.isNaNorUndefined=e,t.renderJs=r,t.runMongo=async function(t,e){const{draw:a,start:n,length:s,searchable:r,search:i,sort:c,select:l}=e,o=r.length&&i?{$or:r.map(e=>{if(function(t,e){const a=t.schema.path(e);return a&&"Number"===a.instance}(t,String(e))){const t=Number(i);return isNaN(t)?void 0:{[e]:t}}return{[e]:new RegExp(i,"i")}}).filter(t=>t)}:{},[d,u,p]=await Promise.all([t.estimatedDocumentCount().exec(),t.countDocuments(o).exec(),t.find(o).sort(c?[Object.values(c)]:{}).select(l).skip(n).limit(s).exec()]);return{draw:a,recordsTotal:d,recordsFiltered:u,data:p}},t.tableParamsSchema={type:"object",properties:{draw:{type:"number"},start:{type:"number"},length:{type:"number"},searchable:{type:"array",items:{anyOf:[{type:"string"},{type:"number"}]}},search:{type:"string"},sort:{type:"object",properties:{key:{type:"string"},dir:{type:"string",enum:["asc","desc"]}}},select:{type:"array",items:{type:"string"}}},required:["draw","start","length","searchable","select"]}});
